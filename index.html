<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OTS Tax Calculator (HGV)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8f9fa; }
    .result-box { background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4 text-center">ðŸš› OTS Tax Calculator (HGV)</h2>

  <form class="border rounded p-4 bg-white shadow-sm">

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Tax From:</label>
        <input type="date" class="form-control" id="startDate" required>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Tax Up To:</label>
        <input type="date" class="form-control" id="endDate" required>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Select RLW (kg):</label>
      <select class="form-select" id="RLW" required>
        <option value="">-- Select RLW --</option>
        <option value="16200">16200 kg</option>
        <option value="18500">18500 kg</option>
        <option value="25000">25000 kg</option>
        <option value="28000">28000 kg</option>
        <option value="31000">31000 kg</option>
        <option value="35000">35000 kg</option>
        <option value="37000">37000 kg</option>
        <option value="42000">42000 kg</option>
        <option value="43000">43000 kg</option>
        <option value="47500">47500 kg</option>
        <option value="49000">49000 kg</option>
        <option value="35200">35200 kg</option>
        <option value="39500">39500 kg</option>
        <option value="40200">40200 kg</option>
        <option value="44000">44000 kg</option>
        <option value="45500">45500 kg</option>
        <option value="54000">54000 kg</option>
        <option value="55000">55000 kg</option>
      </select>
    </div>

    <div class="text-center">
      <button type="button" class="btn btn-primary me-2" onclick="calculateTax()">Calculate Tax</button>
      <input type="reset" class="btn btn-secondary" value="Reset">
    </div>
  </form>

  <div class="mt-4 result-box">
    <h4>Result:</h4>
    <div id="output"></div>
  </div>
</div>

<script>
function calculateTax() {
  const rlw = parseInt(document.getElementById("RLW").value);
  const startDate = new Date(document.getElementById("startDate").value);
  const endDate = new Date(document.getElementById("endDate").value);
  const output = document.getElementById("output");
  output.innerHTML = "";

  if (!rlw || !startDate || !endDate || startDate > endDate) {
    alert("Please enter valid dates and RLW.");
    return;
  }

  // RLW â†’ Quarterly Tax Rate Mapping
  const rlwRates = {
    16200: 2610, 18500: 4750, 25000: 4750, 28000: 6500,
    31000: 6500, 35000: 8000, 37000: 9000, 42000: 11500,
    43000: 12000, 47500: 14250, 49000: 15000, 35200: 8000,
    39500: 10250, 40200: 10500, 44000: 12500, 45500: 13250,
    54000: 17500, 55000: 18000
  };
  const rate = rlwRates[rlw];

  // Calculate number of quarters between start and end
  let sY = startDate.getFullYear(), sQ = Math.floor(startDate.getMonth() / 3);
  let eY = endDate.getFullYear(), eQ = Math.floor(endDate.getMonth() / 3);
  const quarters = (eY - sY) * 4 + (eQ - sQ) + 1;

  // TODAY fixed as per your rule
  const today = new Date("2025-11-19");

  let totalTax = 0;
  let totalPenalty = 0;

  let tableRows = "";

  for (let i = 0; i < quarters; i++) {

    // Identify quarter
    let qYear = sY + Math.floor((sQ + i) / 4);
    let qNumber = (sQ + i) % 4;

    // Quarter end dates
    const quarterEndDates = [
      new Date(qYear, 2, 31), // Q1 ends 31 March
      new Date(qYear, 5, 30), // Q2 ends 30 June
      new Date(qYear, 8, 30), // Q3 ends 30 September
      new Date(qYear, 11, 31) // Q4 ends 31 December
    ];

    let quarterEnd = quarterEndDates[qNumber];

    // Calculate delay from quarter end â†’ today
    let daysLate = Math.floor((today - quarterEnd) / (1000 * 60 * 60 * 24));
    if (daysLate < 0) daysLate = 0;

    // Penalty slab selection
    let penaltyRate = 0;
    if (daysLate >= 15 && daysLate <= 30) penaltyRate = 0.25;
    else if (daysLate >= 31 && daysLate <= 45) penaltyRate = 0.50;
    else if (daysLate >= 46 && daysLate <= 60) penaltyRate = 1.00;
    else if (daysLate > 60) penaltyRate = 2.00;

    let taxForQuarter = rate;
    let penalty = taxForQuarter * penaltyRate;

    totalTax += taxForQuarter;
    totalPenalty += penalty;

    // Build table row
    tableRows += `
      <tr>
        <td>Q${qNumber + 1} ${qYear}</td>
        <td>${quarterEnd.toISOString().split("T")[0]}</td>
        <td>${daysLate}</td>
        <td>${(penaltyRate * 100)}%</td>
        <td>â‚¹${penalty}</td>
      </tr>
    `;
  }

  const grandTotal = totalTax + totalPenalty;

  // Final Output
  output.innerHTML = `
    <h5>Quarter-wise Penalty Breakdown</h5>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Quarter</th>
          <th>Quarter End</th>
          <th>Days Late</th>
          <th>Penalty %</th>
          <th>Penalty Amount</th>
        </tr>
      </thead>
      <tbody>
        ${tableRows}
      </tbody>
    </table>

    <p><strong>Total Quarters:</strong> ${quarters}</p>
    <p><strong>Tax Per Quarter:</strong> â‚¹${rate}</p>
    <p><strong>Total Tax:</strong> â‚¹${totalTax}</p>
    <p><strong>Total Penalty:</strong> â‚¹${totalPenalty}</p>
    <hr>
    <h4 class="text-danger"><strong>Total Payable: â‚¹${grandTotal}</strong></h4>
  `;
}
</script>



</body>
</html>


