<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OTS Tax Calculator (HGV)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8f9fa; }
    .result-box { background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    table { background:white; }
  </style>
</head>
<body>
<div class="container mt-5">

  <h2 class="mb-4 text-center">ðŸš› Tax Calculator (HGV)</h2>

  <form class="border rounded p-4 bg-white shadow-sm">

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Tax From:</label>
        <input type="date" class="form-control" id="startDate" required>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Tax Up To:</label>
        <input type="date" class="form-control" id="endDate" required>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Select RLW (kg):</label>
      <select class="form-select" id="RLW" required>
        <option value="">-- Select RLW --</option>
        <option value="2610">16200 kg</option>
        <option value="4750">18500 kg</option>
        <option value="4750">25000 kg</option>
        <option value="6500">28000 kg</option>
        <option value="6500">31000 kg</option>
        <option value="8000">35000 kg</option>
        <option value="9000">37000 kg</option>
        <option value="11500">42000 kg</option>
        <option value="12000">43000 kg</option>
        <option value="14250">47500 kg</option>
        <option value="15000">49000 kg</option>
        <option value="8000">35200 kg</option>
        <option value="10250">39500 kg</option>
        <option value="10500">40200 kg</option>
        <option value="12500">44000 kg</option>
        <option value="13250">45500 kg</option>
        <option value="17500">54000 kg</option>
        <option value="18000">55000 kg</option>
      </select>
    </div>

    <div class="text-center">
      <button type="button" class="btn btn-primary me-2" onclick="calculateTax()">Calculate Tax</button>
      <input type="reset" class="btn btn-secondary" value="Reset">
    </div>
  </form>

  <div class="mt-4 result-box">
    <h4>Result:</h4>
    <div id="output"></div>
  </div>
</div>

<script>
function calculateTax() {
  const rate = parseInt(document.getElementById("RLW").value);
  const start = new Date(document.getElementById("startDate").value);
  const end = new Date(document.getElementById("endDate").value);
  const output = document.getElementById("output");
  output.innerHTML = "";

  if (!rate || !start || !end || start > end) {
    alert("Please enter valid dates and RLW.");
    return;
  }

  // FIXED TODAY DATE AS PER YOUR REQUIREMENT
  const today = new Date("2025-11-19");

  let quarters = [];
  let sYear = start.getFullYear();
  let sMonth = start.getMonth() + 1; // correct month 1â€“12
  let sQ = Math.floor((sMonth - 1) / 3);

  let eYear = end.getFullYear();
  let eMonth = end.getMonth() + 1;
  let eQ = Math.floor((eMonth - 1) / 3);

  let totalQ = (eYear - sYear) * 4 + (eQ - sQ) + 1;

  for (let i = 0; i < totalQ; i++) {
    let qIndex = sQ + i;
    let year = sYear + Math.floor(qIndex / 4);
    let quarter = qIndex % 4;

    let qStartMonth = quarter * 3 + 1;            // 1,4,7,10
    let qEndMonth = qStartMonth + 2;              // Mar, Jun, Sep, Dec

    let qStartDate = new Date(year, qStartMonth - 1, 1);
    let qEndDate = new Date(year, qEndMonth, 0);

    // SKIP extra quarters before selected start date
    if (qStartDate < start) qStartDate = start;
    // SKIP extra quarters after selected end date
    if (qEndDate > end) qEndDate = end;

    // Delay = today - quarter start date (YOUR RULE)
    let daysLate = Math.floor((today - qStartDate) / (1000 * 60 * 60 * 24));
    if (daysLate < 0) daysLate = 0;

    // Penalty Slabs
    let penaltyRate = 0;
    if (daysLate >= 15 && daysLate <= 30) penaltyRate = 0.25;
    else if (daysLate >= 31 && daysLate <= 45) penaltyRate = 0.50;
    else if (daysLate >= 46 && daysLate <= 60) penaltyRate = 1.00;
    else if (daysLate > 60) penaltyRate = 2.00;

    let tax = rate;
    let penalty = rate * penaltyRate;

    quarters.push({
      q: quarter + 1,
      year: year,
      start: qStartDate.toISOString().split("T")[0],
      daysLate: daysLate,
      penaltyRate: penaltyRate * 100,
      penalty: penalty,
      tax: tax
    });
  }

  // Build output table
  let html = `
  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <th>Quarter</th>
        <th>Start Date</th>
        <th>Days Late</th>
        <th>Penalty %</th>
        <th>Penalty Amount</th>
        <th>Tax</th>
      </tr>
    </thead>
    <tbody>
  `;

  let totalTax = 0, totalPenalty = 0;

  quarters.forEach(q => {
    totalTax += q.tax;
    totalPenalty += q.penalty;

    html += `
      <tr>
        <td>Q${q.q} ${q.year}</td>
        <td>${q.start}</td>
        <td>${q.daysLate}</td>
        <td>${q.penaltyRate}%</td>
        <td>â‚¹${q.penalty.toLocaleString()}</td>
        <td>â‚¹${q.tax.toLocaleString()}</td>
      </tr>
    `;
  });

  html += `
    </tbody>
  </table>
  <h4>Total Tax: â‚¹${totalTax.toLocaleString()}</h4>
  <h4>Total Penalty: â‚¹${totalPenalty.toLocaleString()}</h4>
  <h3 class="text-danger">Total Payable: â‚¹${(totalTax + totalPenalty).toLocaleString()}</h3>
  `;

  output.innerHTML = html;
}
</script>

</body>
</html>
