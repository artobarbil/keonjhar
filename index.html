<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OTS Tax Calculator (HGV)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body { background-color: #f9f9f9; }
    .result-box { background-color: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    @media print {
      body * { visibility: hidden; }
      #printSection, #printSection * { visibility: visible; }
      #printSection { position: absolute; top: 0; left: 0; width: 100%; }
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4 text-center">üöõ OTS Tax Calculator (HGV)</h2>

  <form id="taxForm" class="border rounded p-4 bg-white shadow-sm">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="startDate" class="form-label">Tax From:</label>
        <input type="date" class="form-control" id="startDate" max="2022-03-31" required>
      </div>

      <div class="col-md-6 mb-3">
        <label for="endDate" class="form-label">Tax Up To:</label>
        <input type="date" class="form-control" id="endDate" min="2024-03-31" required>
      </div>
    </div>

    <div class="mb-3">
      <label for="RLW" class="form-label">Select RLW (kg):</label>
      <select class="form-select" id="RLW" required>
        <option value="">-- Select RLW --</option>
        <option value="16200">16200 kg</option>
        <option value="18500">18500 kg</option>
        <option value="25000">25000 kg</option>
        <option value="28000">28000 kg</option>
        <option value="31000">31000 kg</option>
        <option value="35000">35000 kg</option>
        <option value="37000">37000 kg</option>
        <option value="42000">42000 kg</option>
        <option value="43000">43000 kg</option>
        <option value="47500">47500 kg</option>
        <option value="49000">49000 kg</option>
        <option value="35200">35200 kg</option>
        <option value="39500">39500 kg</option>
        <option value="40200">40200 kg</option>
        <option value="44000">44000 kg</option>
        <option value="45500">45500 kg</option>
        <option value="54000">54000 kg</option>
        <option value="55000">55000 kg</option>
      </select>
    </div>

    <div class="text-center">
      <button type="button" class="btn btn-primary me-2" onclick="calculateTax()">Calculate Tax</button>
      <input type="reset" class="btn btn-secondary me-2" value="Reset">
      <button type="button" class="btn btn-success" onclick="printResult()">üñ®Ô∏è Print / Save as PDF</button>
    </div>
  </form>

  <div class="mt-4 result-box p-4 rounded" id="printSection">
    <h4>Result:</h4>
    <div id="output" class="border rounded p-3 bg-light"></div>
  </div>
</div>

<script>
function calculateTax() {
  const rlw = parseInt(document.getElementById("RLW").value);
  const startDate = new Date(document.getElementById("startDate").value);
  const endDate = new Date(document.getElementById("endDate").value);
  const output = document.getElementById("output");
  output.innerHTML = "";

  if (!rlw || !startDate || !endDate) {
    alert("‚ö†Ô∏è Please fill all fields correctly before calculating.");
    return;
  }

  const rlwRates = {
    16200: 2610, 18500: 4750, 25000: 4750, 28000: 6500,
    31000: 6500, 35000: 8000, 37000: 9000, 42000: 11500,
    43000: 12000, 47500: 14250, 49000: 15000,
    35200: 8000, 39500: 10250, 40200: 10500,
    44000: 12500, 45500: 13250, 54000: 17500, 55000: 18000
  };

  const rate = rlwRates[rlw];
  const today = new Date();

  // Quarter calculations
  const monthsDiff = (endDate.getFullYear() - startDate.getFullYear()) * 12 + (endDate.getMonth() - startDate.getMonth());
  const quarters = Math.floor(monthsDiff / 3 + 1);

  const date2022 = new Date("2022-04-01");
  const m = (endDate.getFullYear() - date2022.getFullYear()) * 12 + (endDate.getMonth() - date2022.getMonth());
  const q = Math.floor(m / 3);
  const q2 = Math.floor(((endDate.getFullYear() - today.getFullYear()) * 12 + (endDate.getMonth() - today.getMonth())) / 3 + 1);

  // Late payment penalty
  const nextQuarter = new Date(today.getFullYear(), Math.floor((today.getMonth() + 3) / 3) * 3, 1);
  const daysLate = Math.round((today - nextQuarter) / (1000 * 60 * 60 * 24));
  let cpenalty = 0;
  if (daysLate > 15 && daysLate < 30) cpenalty = 0.25;
  else if (daysLate < 45) cpenalty = 0.5;
  else if (daysLate < 75) cpenalty = 1;
  else if (daysLate < 92) cpenalty = 2;

  // Calculations
  const taxAmt = rate * quarters;
  const penalty = (rate * (quarters - q2) * 2) + (rate * cpenalty);
  const penaltyPayable = (rate * (q - q2) * 2) + (rate * cpenalty);
  const diffQ = quarters - q;
  const interest = diffQ > 0 ? (diffQ * rate) * 0.12 : 0;
  const total = taxAmt + penaltyPayable + interest;

  // Display results
  output.innerHTML = `
    <p><strong>Number of Quarters:</strong> ${quarters}</p>
    <p><strong>Tax per Quarter:</strong> ‚Çπ${rate}</p>
    <p><strong>Tax Amount:</strong> ‚Çπ${taxAmt}</p>
    <p><strong>Penalty:</strong> ‚Çπ${penalty}</p>
    <p><strong>Waived Penalty:</strong> ‚Çπ${penalty - penaltyPayable}</p>
    <p><strong>Payable Penalty:</strong> ‚Çπ${penaltyPayable}</p>
    <p><strong>Tax & Penalty to Collect:</strong> ‚Çπ${taxAmt + penaltyPayable}</p>
    <p><strong>Interest @12%:</strong> ‚Çπ${interest.toFixed(2)}</p>
    <hr>
    <h5 class="text-danger fw-bold"><strong>Total Payable: ‚Çπ${total.toFixed(2)}</strong></h5>
    <p class="mt-3"><em>Calculated on: ${today.toLocaleDateString()}</em></p>
  `;
}

function printResult() {
  const result = document.getElementById("output").innerHTML.trim();
  if (!result) {
    alert("‚ö†Ô∏è Please calculate the tax before printing.");
    return;
  }
  window.print();
}
</script>
</body>
</html>
